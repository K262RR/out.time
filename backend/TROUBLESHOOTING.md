# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø–æ–∏—Å–∫—É –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π (Backend)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –∏ —Å–ø–æ—Å–æ–±—ã –∏—Ö —Ä–µ—à–µ–Ω–∏—è, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –º–æ–∂–Ω–æ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è –ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ –±—ç–∫–µ–Ω–¥–∞.

## 1. –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –ø—Ä–∏–≥–ª–∞—Å–∏—Ç–µ–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –≤ Telegram-–±–æ—Ç–µ, –±–æ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ:

```
üòî –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
```

–ü—Ä–∏ —ç—Ç–æ–º –≤ –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ (–≤ –∫–æ–Ω—Å–æ–ª–∏, –µ—Å–ª–∏ `NODE_ENV=development`) –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è –æ—à–∏–±–∫–∞:

```
–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: FetchError: invalid json response body at ... reason: Unexpected token '–°', "–°–ª–∏—à–∫–æ–º –º–Ω"... is not valid JSON
```

### –ü—Ä–∏—á–∏–Ω–∞

–≠—Ç–∞ –æ—à–∏–±–∫–∞ –≤—ã–∑–≤–∞–Ω–∞ **–æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–µ–º –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiter)**, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º –¥–ª—è API –±–æ—Ç–∞ –≤ —Ñ–∞–π–ª–µ `backend/src/routes/bot.js`.

–ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –±—ã—Å—Ç—Ä—ã—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API:
1.  `GET /api/bot/validate-invite/:token` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏ —Ç–æ–∫–µ–Ω–∞.
2.  `POST /api/bot/register` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `rate-limiter` –±—ã–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–ª–∏—à–∫–æ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1 –∑–∞–ø—Ä–æ—Å –≤ 2 —Å–µ–∫—É–Ω–¥—ã), –∏–∑-–∑–∞ —á–µ–≥–æ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª—Å—è.

–ö–ª—é—á–µ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∑–∞–∫–ª—é—á–∞–ª–∞—Å—å –≤ —Ç–æ–º, —á—Ç–æ –ø—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ `rate-limiter` –≤–æ–∑–≤—Ä–∞—â–∞–ª –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ –æ–±—ã—á–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤..."), –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ –±–æ—Ç–µ (`startHandler.js`) –æ–∂–∏–¥–∞–ª –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ `JSON`. –ü–æ–ø—ã—Ç–∫–∞ —Ä–∞–∑–æ–±—Ä–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç–≤–µ—Ç –∫–∞–∫ JSON –ø—Ä–∏–≤–æ–¥–∏–ª–∞ –∫ —Å–±–æ—é `FetchError: invalid json response body`.

### –†–µ—à–µ–Ω–∏–µ

–†–µ—à–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —á–∞—Å—Ç–µ–π:

1.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å `rate-limiter` –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.** –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º—É –∫–æ–¥—É (–±–æ—Ç—É) –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫—É –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤, –Ω–µ –≤—ã–∑—ã–≤–∞—è —Å–±–æ–π –ø–∞—Ä—Å–∏–Ω–≥–∞.
2.  **–û—Å–ª–∞–±–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ª–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è,** —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –º–µ—à–∞–ª–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ `backend/src/routes/bot.js`:**

```javascript
const botLimiter = rateLimit({
  windowMs: 10 * 1000, // 10 —Å–µ–∫—É–Ω–¥
  max: 5, // 5 –∑–∞–ø—Ä–æ—Å–æ–≤
  standardHeaders: true,
  legacyHeaders: false,
  handler: (req, res, next, options) => {
    logger.warn(`Rate limit exceeded for bot API from: ${req.ip}`);
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
    res.status(options.statusCode).json({
      success: false,
      error: "–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ.",
    });
  },
}); 